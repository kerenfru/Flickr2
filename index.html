<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Flickr gallery</title>
  <script src="jquery-2.1.1.min.js"></script>
  
<script>
	var height = $(window).height();
	var width = $(window).width();
	var totalPhotos = 20;
	var flickerFeedUrl = "http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?";
	var flickerFeedUrlAuthor = "http://api.flickr.com/services/feeds/photos_public.gne?id=AUTHORID&jsoncallback=?";
	
$( document ).ready(function() {
    console.log( "ready!" );
	
	$('#loadFlickr').click(function() {
		loadFlickrAgain(flickerFeedUrl);
	});

	getData(flickerFeedUrl);
});


function getData(Url) {
	var photosCounter = 0;
	var rowX = (width / 7);
	var rowY = 1;
	var tmp = 1;
	
	$("#loading").show();
	
	  $.getJSON(Url,{
		format: "json"
	  })
		.done(function( data ) {
		// Open Box
		$('.boxCover').addClass("openBoxCover");
		
		// wait for the box to be open
		setTimeout( function () {
		
		  $.each( data.items, function( i, item ) {
			var wrapper = $( "<div class=\"gallery-item wrapper" + i + "\">").css("top", (height-100) + "px").appendTo("#gallery");
			
			// Appending the photos to the gallery
			setTimeout( function () {
					
					var rotateSign = Math.floor((Math.random() * 2) + 1);
					var rotateNum = Math.floor((Math.random() * 5) + 1);
					var posY = (rowY*22)+ "px";
					var posX = (rowX*tmp) + "px";
					var rotate;
			
					if (((i+1)%5)===0) { 
						rowY+=8;
						tmp = 0;
					}
					
					tmp++;
					if (rotateSign == 1) {
						rotate = rotateNum;
					}
					else {
						rotate = "-" + rotateNum;
					}
			

				$( "<img class=\"photo\">" ).attr( "src", item.media.m ).appendTo(".wrapper" + i).load(
					function() {
						photosCounter++;
						if (photosCounter === totalPhotos) {
							$("#loading").hide();
							$('.boxCover').removeClass("openBoxCover");
						}
					}).parent().animate({
						opacity: 1,
						width : "150px",
						height : "150px",
						left: posX,
						top:posY
					}, 
					{
						step: function(now,fx) {
						  $(this).css('padding','5px 5px 5px 5px');
						  $(this).css('background-color','white');
						  $(this).css('-webkit-transform','rotate(' + rotate + 'deg)');
						  $(this).css('-moz-transform','rotate(' + rotate + 'deg)'); 
						  $(this).css('-ms-transform','rotate(' + rotate + 'deg)');
						  $(this).css('-o-transform','rotate(' + rotate + 'deg)');
						  $(this).css('transform','rotate(' + rotate + 'deg)');  
						},
						duration:'slow'
					},'linear');
				
				// add photo details
				$( "<span class=\"photo-details hide\">" ).html(
					"Title: " + (item.title.length > 30 ? item.title.substring(0,27) + "..." : item.title) + 
					"<br/> Date: " + new Date(item.date_taken).toLocaleString() + 
					"<br/> Author: <a href=\"#\" onclick=\"showAuthor('" + item.author_id + "')\">" + item.author.substring(item.author.indexOf("(")+1,item.author.indexOf(")")) + "</a>" + 
					"<br/> Link: <a href=\"" + item.media.m + "\">Click Here</a>")
					.appendTo(".wrapper" + i);
				
				$(".wrapper" + i).hover(function() {
					$(this).find('.photo-details').toggleClass("hide");
					$(this).find('img').toggleClass("fade");
				});
				
			}, (i * 100));
		  });
		  }, 300);
		});
	}
	
	function showAuthor(author) {

		ClearGallery();
		
		setTimeout(function() {
			// Clear Gallery
			$('.gallery-item').remove();
			getData(flickerFeedUrlAuthor.replace("AUTHORID", author));
		},3000);
	}
	
	function loadFlickrAgain(Url) {
		console.log("ccc");

		ClearGallery();
		
		setTimeout(function() {
			// Clear Gallery
			$('.gallery-item').remove();
			getData(Url);
		},3000);
	}
	
	function ClearGallery() {
		var rotate = "-100";
			
		$.each([ 12,3,7,18,5,0,16,6,1,17,11,2,10,4,8,13,9,14,15,19], function( index, value ) {
			setTimeout(function() {
				$('.wrapper' + value).animate({
						width : "150px",
						height : "150px",
						opacity: "0",
						top:height
					}, 
					{
						step: function(now,fx) {
						   $(this).css('padding','5px 5px 5px 5px');
						   $(this).css('background-color','white');
						   $(this).css('-webkit-transform','rotate(' + rotate + 'deg)');
						   $(this).css('-moz-transform','rotate(' + rotate + 'deg)'); 
						   $(this).css('-ms-transform','rotate(' + rotate + 'deg)');
						   $(this).css('-o-transform','rotate(' + rotate + 'deg)');
						   $(this).css('transform','rotate(' + rotate + 'deg)');  
						},
						duration:'slow'
					},'linear');
			},(index*100));
		});
	}
</script>

<style>
body {
	background: url(background.jpg) no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}

#gallery{
	width : 80%;
	display: block;
    margin-left: auto;
    margin-right: auto;
}

.gallery-item {
    position: absolute;
    left: 80px;
    width: 0px;
    height: 0px;
    margin: 0px;
}

#loadFlickr {
	float: right;
	right:-5px;
	top:20px;
}

.photo {
	display: block;
    margin-left: auto;
    margin-right: auto;
	width: 100%;
	height: 100%;
}

.photo-details {
	position: absolute;
	left: -1%;
	top: 0;
}

a.loading{
	z-index:999999;
	cursor:pointer;
	border:1px solid #aaa;
	width:50px;
	height:50px;
	position:absolute;
	top:50%;
	left:50%;
	opacity:0.8;
	margin:-25px 0px 0px -25px;
	-moz-border-radius:8px;
	-webkit-border-radius:8px;
	border-radius:8px;
}
a.loading{
	background:#B8B8B8 url(../images/loading.gif) no-repeat 50% 50%;
}
a.loading:hover{
	opacity:1.0;
}

.hide {
	display:none;
}

.fade {
	opacity : .3;
}

.boxCover {
    width: 130px;
    height: 45px;
    display: block;
    margin-left: auto;
    margin-right: auto;
	
   -webkit-transition-duration: 0.8s;
    -moz-transition-duration: 0.8s;
    -o-transition-duration: 0.8s;
    transition-duration: 0.8s;
}

.boxBody {
    width: 120px;
    height: 75px;
    display: block;
    margin-left: auto;
    margin-right: auto;
}


#box {
	bottom: 40px;
    position: fixed;
    left: 40px;
}

.openBoxCover {
    -ms-transform: rotate(-45deg) translate(-15px, -35px); /* IE 9 */
    -webkit-transform: rotate(-45deg) translate(-15px, -35px);
    transform: rotate(-45deg) translate(-15px, -35px);
}


button, .button {
  border-style: solid;
  border-width: 0px;
  cursor: pointer;
  font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
  font-weight: normal;
  line-height: normal;
  margin: 0 0 1.25rem;
  position: relative;
  text-decoration: none;
  text-align: center;
  -webkit-appearance: none;
  -webkit-border-radius: 0;
  display: inline-block;
  padding-top: 1rem;
  padding-right: 2rem;
  padding-bottom: 1.0625rem;
  padding-left: 2rem;
  font-size: 1rem;
  background-color: #008cba;
  border-color: #007095;
  color: white;
  transition: background-color 300ms ease-out; }
  button:hover, button:focus, .button:hover, .button:focus {
    background-color: #007095; }
  button:hover, button:focus, .button:hover, .button:focus {
    color: white; }
</style>

</head>
<body>
	<div>
		<a id="loading" href="#" class="loading"></a>
	</div>
			
		<button id="loadFlickr">Load Flickr</button>
	
	<div id="gallery"></div>
	<div id="box">
		<img class="boxCover" src="boxCover.png" />
		<img class="boxBody" src="boxBody.png" />
	</div>
</body>
</html>